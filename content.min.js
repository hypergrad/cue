!function(){if(window.__CPRM_CONTENT_LOADED__)return;window.__CPRM_CONTENT_LOADED__=!0;const e="cprm-side-panel",t="cprm-side-style",n=chrome.storage?.local;let o="zh";const a={en:{title:"Cue",copy:"Copy",apply:"Apply",save:"Save",close:"Close",placeholder:"Type or paste your prompt...",titlePlaceholder:"Title (optional)",history:"History",histLoad:"Load to Panel",histCopy:"Copy",histEdit:"Edit",histDelete:"Delete",histApply:"Apply",toastCopied:"Copied to clipboard",toastSaved:"Saved",toastEmpty:"Empty content",toastNoInput:"No input field found",toastApplied:"Filled into the page",editTitle:"Edit title",editContent:"Edit content",untitled:"Untitled",slogan:"Your Magic Wand for AI"},zh:{title:"Cue",copy:"复制",apply:"应用",save:"保存",close:"关闭",placeholder:"输入或粘贴提示词...",titlePlaceholder:"标题（可选）",history:"历史提示词",histLoad:"载入到面板",histCopy:"复制",histEdit:"编辑",histDelete:"删除",histApply:"应用",toastCopied:"已复制到剪贴板",toastSaved:"已保存",toastEmpty:"内容为空",toastNoInput:"未找到可输入的框",toastApplied:"已填充到页面",editTitle:"编辑标题",editContent:"编辑内容",untitled:"未命名",slogan:"你的AI魔法棒"}};function r(e){return(a[o]||a.zh)[e]||""}function i(){if(document.getElementById(e))return document.getElementById(e);!function(){if(document.getElementById(t))return;const n=document.createElement("style");n.id=t,n.textContent=`\n      #${e} { position: fixed; top: 0; right: 0; height: 100vh; width: 380px; max-width: 100vw; z-index: 2147483647; box-shadow: -2px 0 10px rgba(0,0,0,.1); background: #fff; color: #333; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; display: none; }\n      #${e}.open { display: flex; }\n      #${e} .cprm-wrap { display: flex; flex-direction: column; width: 100%; height: 100%; }\n      #${e} header { display:flex; align-items:center; justify-content: space-between; padding: 10px 12px; border-bottom: 1px solid #eee; background: #fafafa; }\n      #${e} header .title-section { display: flex; flex-direction: column; }\n      #${e} header .title { font-weight: 600; font-size: 18px; }\n      #${e} header .slogan { font-size: 12px; color: #666; font-style: italic; margin-top: 2px; }\n      #${e} header .actions { display:flex; gap:8px; }\n      #${e} main { padding: 12px; display: flex; flex-direction: column; gap: 8px; overflow: auto; }\n      #${e} textarea { width: 100%; min-height: 120px; resize: vertical; padding:8px; border:1px solid #ddd; border-radius: 6px; font-size: 14px; }\n      #${e} input[type="text"] { width: 100%; padding:8px; border:1px solid #ddd; border-radius:6px; }\n      #${e} .btn { padding: 6px 10px; border: 1px solid #ddd; background: #fff; border-radius: 6px; cursor: pointer; }\n      #${e} .btn.primary { background: #1677ff; color: #fff; border-color: #1677ff; }\n      #${e} .row { display:flex; gap:8px; flex-wrap: wrap; }\n      #${e} .history { border-top:1px dashed #eee; padding-top: 8px; margin-top: 8px; }\n      #${e} .item { padding:8px; border:1px solid #eee; border-radius:6px; margin:6px 0; }\n      #${e} .item .meta { display:flex; justify-content: space-between; align-items:center; margin-bottom:6px; }\n      #${e} .muted { color:#888; font-size: 12px; }\n      /* theme: dark */\n      #${e}[data-theme="dark"] { background: #111; color: #eee; }\n      #${e}[data-theme="dark"] header { background: #181818; border-bottom-color: #222; }\n      #${e}[data-theme="dark"] header .slogan { color: #aaa; }\n      #${e}[data-theme="dark"] textarea, #${e}[data-theme="dark"] input[type="text"] { background:#1b1b1b; color:#eee; border-color:#333; }\n      #${e}[data-theme="dark"] .btn { background:#222; color:#eee; border-color:#333; }\n      #${e}[data-theme="dark"] .btn.primary { background:#1677ff; color:#fff; border-color:#1677ff; }\n      #${e}[data-theme="dark"] .item { border-color:#222; }\n      #${e}[data-theme="dark"] .muted { color:#aaa; }\n      /* theme: chinese */\n      #${e}[data-theme="chinese"] { \n        background: #f7f4e9; \n        color: #1a1a1a; \n        font-family: "Noto Serif SC", "Songti SC", "SimSun", "STSong", serif;\n        background-image: radial-gradient(rgba(0,0,0,0.02) 1px, transparent 1px);\n        background-size: 6px 6px;\n      }\n      #${e}[data-theme="chinese"] header { \n        background: #fffaf0; \n        border-bottom: 2px solid #a61b29; \n      }\n      #${e}[data-theme="chinese"] header .title { letter-spacing: 1px; color: #a61b29; }\n      #${e}[data-theme="chinese"] header .slogan { color: #8b4513; font-family: "KaiTi", "楷体", serif; }\n      #${e}[data-theme="chinese"] .btn { \n        background: #fff;\n        border: 1px solid #d8c3a5;\n        color: #1a1a1a;\n        border-radius: 8px;\n      }\n      #${e}[data-theme="chinese"] .btn.primary { \n        background: #a61b29; \n        color: #fff; \n        border-color: #a61b29;\n      }\n      #${e}[data-theme="chinese"] textarea, \n      #${e}[data-theme="chinese"] input[type="text"] {\n        background: #fffdf6; \n        border-color: #e8d9c3; \n      }\n      #${e}[data-theme="chinese"] .item { \n        border-color: #e8d9c3; \n        background: #fffef9;\n      }\n      #${e}[data-theme="chinese"] .muted { color: #6f6a60; }\n      \n      /* Edit Modal Styles */\n      .cprm-edit-modal { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); z-index: 2147483648; display: none; }\n      .cprm-edit-modal.open { display: flex; align-items: center; justify-content: center; }\n      .cprm-edit-content { background: #fff; border-radius: 12px; padding: 24px; width: 90%; max-width: 500px; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }\n      .cprm-edit-header { margin-bottom: 20px; }\n      .cprm-edit-title { font-size: 18px; font-weight: 600; margin-bottom: 8px; }\n      .cprm-edit-field { margin-bottom: 16px; }\n      .cprm-edit-label { display: block; margin-bottom: 6px; font-weight: 500; color: #555; }\n      .cprm-edit-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; box-sizing: border-box; }\n      .cprm-edit-textarea { width: 100%; min-height: 120px; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; resize: vertical; box-sizing: border-box; font-family: inherit; }\n      .cprm-edit-actions { display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px; }\n      .cprm-edit-btn { padding: 10px 20px; border: 1px solid #ddd; background: #fff; border-radius: 6px; cursor: pointer; font-size: 14px; }\n      .cprm-edit-btn.primary { background: #1677ff; color: #fff; border-color: #1677ff; }\n      .cprm-edit-btn.primary:hover { background: #0056b3; }\n      .cprm-edit-btn:hover { background: #f5f5f5; }\n      \n      /* Dark theme for modal */\n      [data-theme="dark"] .cprm-edit-content { background: #1a1a1a; color: #eee; }\n      [data-theme="dark"] .cprm-edit-input, [data-theme="dark"] .cprm-edit-textarea { background: #2a2a2a; color: #eee; border-color: #444; }\n      [data-theme="dark"] .cprm-edit-btn { background: #333; color: #eee; border-color: #555; }\n      [data-theme="dark"] .cprm-edit-btn:hover { background: #444; }\n      \n      /* Chinese theme for modal */\n      [data-theme="chinese"] .cprm-edit-content { background: #f7f4e9; color: #1a1a1a; border: 2px solid #d8c3a5; }\n      [data-theme="chinese"] .cprm-edit-input, [data-theme="chinese"] .cprm-edit-textarea { background: #fffdf6; border-color: #e8d9c3; }\n      [data-theme="chinese"] .cprm-edit-btn { background: #fff; border-color: #d8c3a5; color: #1a1a1a; }\n      [data-theme="chinese"] .cprm-edit-btn.primary { background: #a61b29; color: #fff; border-color: #a61b29; }\n    `,document.head.appendChild(n)}();const a=document.createElement("div");return a.id=e,a.innerHTML='\n      <div class="cprm-wrap">\n        <header>\n          <div class="title-section">\n            <div class="title">CUE</div>\n            <div class="slogan">Your Magic Wand for AI</div>\n          </div>\n          <div class="actions">\n            <button class="btn" id="cprm-copy">复制</button>\n            <button class="btn" id="cprm-apply">应用</button>\n            <button class="btn" id="cprm-save">保存</button>\n            <button class="btn" id="cprm-close">关闭</button>\n          </div>\n        </header>\n        <main>\n          <textarea id="cprm-input" placeholder="输入或粘贴提示词..."></textarea>\n          <div class="row">\n            <input id="cprm-title" type="text" placeholder="标题（可选）" />\n          </div>\n          <section class="history">\n            <div class="muted">历史提示词</div>\n            <div id="cprm-list"></div>\n          </section>\n        </main>\n      </div>\n    ',document.body.appendChild(a),function(e){e.querySelector("#cprm-close").addEventListener("click",()=>p(!1)),e.querySelector("#cprm-copy").addEventListener("click",()=>{const t=e.querySelector("#cprm-input").value;navigator.clipboard.writeText(t||"").then(()=>{d(r("toastCopied"))})}),e.querySelector("#cprm-apply").addEventListener("click",()=>s()),e.querySelector("#cprm-save").addEventListener("click",()=>function(e){const t=e.querySelector("#cprm-input"),o=e.querySelector("#cprm-title"),a=t.value.trim();if(!a)return d(r("toastEmpty"));const i=(o.value||r("untitled")).trim();n.get(["prompts"],({prompts:t})=>{const o=Array.isArray(t)?t:[],l=(i||"item").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,40)+"-"+Date.now().toString(36);o.unshift({id:l,title:i,text:a}),n.set({prompts:o.slice(0,200)},()=>{d(r("toastSaved")),c(e)})})}(e))}(a),c(a),function(e){n.get(["settings"],({settings:t})=>{o=(t=t||{locale:"zh",theme:"chinese",panelWidth:380}).locale||"zh";const n=Number(t.panelWidth)||380;e.style.width=Math.max(280,Math.min(600,n))+"px",e.setAttribute("data-theme",t.theme||"chinese"),function(e){const t=e.querySelector("header .title-section .title"),n=e.querySelector("header .title-section .slogan"),o=e.querySelector("#cprm-copy"),a=e.querySelector("#cprm-apply"),i=e.querySelector("#cprm-save"),d=e.querySelector("#cprm-close"),c=e.querySelector("#cprm-input"),l=e.querySelector("#cprm-title"),p=e.querySelector(".history .muted");t&&(t.textContent=r("title"));n&&(n.textContent=r("slogan"));o&&(o.textContent=r("copy"));a&&(a.textContent=r("apply"));i&&(i.textContent=r("save"));d&&(d.textContent=r("close"));c&&c.setAttribute("placeholder",r("placeholder"));l&&l.setAttribute("placeholder",r("titlePlaceholder"));p&&(p.textContent=r("history"))}(e)})}(a),a}function d(e){try{const t=document.createElement("div");t.textContent=e,t.style.cssText="position:fixed;right:8px;top:8px;background:rgba(0,0,0,.75);color:#fff;padding:6px 10px;border-radius:6px;z-index:2147483647;",document.body.appendChild(t),setTimeout(()=>t.remove(),1200)}catch{}}async function c(t){const o=t.querySelector("#cprm-list"),a=t.querySelector("#cprm-input"),i=t.querySelector("#cprm-title");n.get(["prompts"],({prompts:t})=>{!function(t,o,a,i){o.innerHTML="",t.forEach((e,t)=>{const n=document.createElement("div");n.className="item",n.innerHTML=`\n        <div class="meta"><strong>${l(e.title||e.id||"无标题")}</strong>\n          <div>\n            <button class="btn" data-act="load" data-idx="${t}">${l(r("histLoad"))}</button>\n            <button class="btn" data-act="copy" data-idx="${t}">${l(r("histCopy"))}</button>\n            <button class="btn" data-act="edit" data-idx="${t}">${l(r("histEdit"))}</button>\n            <button class="btn" data-act="del" data-idx="${t}">${l(r("histDelete"))}</button>\n            <button class="btn" data-act="apply" data-idx="${t}">${l(r("histApply"))}</button>\n          </div>\n        </div>\n        <div class="muted">${l((e.text||"").slice(0,120))}</div>\n      `,o.appendChild(n)}),o.addEventListener("click",t=>{const o=t.target;if(!(o instanceof HTMLElement))return;const p=o.getAttribute("data-act"),m=Number(o.getAttribute("data-idx"));p&&!Number.isNaN(m)&&n.get(["prompts"],({prompts:t})=>{const o=Array.isArray(t)?t:[],u=o[m];u&&("load"===p?(a.value=u.text||"",i.value=u.title||""):"copy"===p?navigator.clipboard.writeText(u.text||"").then(()=>d(r("toastCopied"))):"edit"===p?function(t,o,a,i){document.querySelectorAll(".cprm-edit-modal").forEach(e=>e.remove());const c=document.createElement("div");c.className="cprm-edit-modal",c.innerHTML=`\n        <div class="cprm-edit-content">\n          <div class="cprm-edit-header">\n            <div class="cprm-edit-title">${r("editTitle")}</div>\n          </div>\n          <div class="cprm-edit-field">\n            <label class="cprm-edit-label">标题</label>\n            <input type="text" class="cprm-edit-input" id="edit-title" value="${l(t.title||"")}" />\n          </div>\n          <div class="cprm-edit-field">\n            <label class="cprm-edit-label">内容</label>\n            <textarea class="cprm-edit-textarea" id="edit-content">${l(t.text||"")}</textarea>\n          </div>\n          <div class="cprm-edit-actions">\n            <button class="cprm-edit-btn" id="edit-cancel">取消</button>\n            <button class="cprm-edit-btn primary" id="edit-save">保存</button>\n          </div>\n        </div>\n      `,document.body.appendChild(c);const p=document.getElementById(e);if(p){const e=p.getAttribute("data-theme");e&&c.setAttribute("data-theme",e)}setTimeout(()=>c.classList.add("open"),10);const s=c.querySelector("#edit-title");function m(e){"Escape"===e.key&&u()}s.focus(),s.select();const u=()=>{c.remove(),document.removeEventListener("keydown",m)};document.addEventListener("keydown",m);c.querySelector("#edit-save").addEventListener("click",()=>{const e=c.querySelector("#edit-title"),l=c.querySelector("#edit-content"),p=e.value.trim(),s=l.value.trim();s?(a[o]={...t,title:p,text:s},n.set({prompts:a},()=>{d(r("toastSaved")),u(),i&&i()})):d(r("toastEmpty"))});c.querySelector("#edit-cancel").addEventListener("click",()=>{u()}),c.addEventListener("click",e=>{e.target===c&&u()})}(u,m,o,()=>c(document.getElementById(e))):"del"===p?(o.splice(m,1),n.set({prompts:o},()=>c(document.getElementById(e)))):"apply"===p&&(a.value=u.text||"",i.value=u.title||"",s()))})})}(Array.isArray(t)?t:[],o,a,i)})}function l(e){return(e||"").replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e]||e))}function p(e){const t=i();"boolean"==typeof e?t.classList.toggle("open",e):t.classList.toggle("open")}function s(){const e=document.querySelector("#cprm-input").value||"";if(!e)return d(r("toastEmpty"));const t=['textarea[placeholder*="Message" i]','textarea, div[contenteditable="true"]','textarea[placeholder*="输入"], textarea[placeholder*="说点什么"], input[type="text"]'];let n=null;for(const e of t)if(n=document.querySelector(e),n)break;if(n||(n=Array.from(document.querySelectorAll('textarea,input[type="text"],div[contenteditable="true"]')).filter(e=>null!==e.offsetParent).sort((e,t)=>t.clientWidth*t.clientHeight-e.clientWidth*e.clientHeight)[0]||null),!n)return d(r("toastNoInput"));var o,a;"value"in n?(a=e,(o=n).value=a,o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0}))):"true"===n.getAttribute("contenteditable")&&(n.focus(),document.execCommand("selectAll",!1,void 0),document.execCommand("insertText",!1,e)),d(r("toastApplied"))}chrome.runtime.onMessage.addListener(e=>{e&&"CPRM_TOGGLE_PANEL"===e.type&&p()})}();